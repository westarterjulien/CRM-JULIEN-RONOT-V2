<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>À propos - CRM Luelis</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #f5f7fa 0%, #e4e8ec 100%);
      min-height: 100vh;
      padding: 24px;
      color: #111;
    }

    .container {
      max-width: 400px;
      margin: 0 auto;
    }

    .header {
      text-align: center;
      margin-bottom: 24px;
    }

    .logo {
      width: 80px;
      height: 80px;
      background: linear-gradient(135deg, #28B95F 0%, #1a8f45 100%);
      border-radius: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 16px;
      box-shadow: 0 8px 24px rgba(40, 185, 95, 0.3);
    }

    .logo span {
      font-size: 40px;
      font-weight: bold;
      color: white;
    }

    .app-name {
      font-size: 24px;
      font-weight: 700;
      color: #111;
      margin-bottom: 4px;
    }

    .version {
      font-size: 14px;
      color: #666;
      font-weight: 500;
    }

    .version-badge {
      display: inline-block;
      background: #28B95F;
      color: white;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 13px;
      font-weight: 600;
      margin-top: 8px;
    }

    .card {
      background: white;
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 16px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.06);
    }

    .card-title {
      font-size: 13px;
      font-weight: 600;
      color: #999;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 12px;
    }

    .update-status {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .status-icon {
      width: 40px;
      height: 40px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }

    .status-icon.checking {
      background: #E3F2FD;
    }

    .status-icon.up-to-date {
      background: #E8F5E9;
    }

    .status-icon.available {
      background: #FFF3E0;
    }

    .status-icon.error {
      background: #FFEBEE;
    }

    .status-icon svg {
      width: 20px;
      height: 20px;
    }

    .status-text {
      flex: 1;
    }

    .status-title {
      font-weight: 600;
      font-size: 14px;
      color: #111;
    }

    .status-desc {
      font-size: 12px;
      color: #666;
      margin-top: 2px;
    }

    .btn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 16px;
      border-radius: 10px;
      font-size: 13px;
      font-weight: 600;
      border: none;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-primary {
      background: #0064FA;
      color: white;
    }

    .btn-primary:hover {
      background: #0052cc;
    }

    .btn-secondary {
      background: #f0f0f0;
      color: #444;
    }

    .btn-secondary:hover {
      background: #e0e0e0;
    }

    .btn-success {
      background: #28B95F;
      color: white;
    }

    .btn-success:hover {
      background: #1fa34e;
    }

    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .info-row {
      display: flex;
      justify-content: space-between;
      padding: 10px 0;
      border-bottom: 1px solid #f0f0f0;
    }

    .info-row:last-child {
      border-bottom: none;
    }

    .info-label {
      color: #666;
      font-size: 13px;
    }

    .info-value {
      color: #111;
      font-size: 13px;
      font-weight: 500;
    }

    .links {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .link-btn {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 8px 12px;
      background: #f5f5f5;
      border-radius: 8px;
      color: #444;
      text-decoration: none;
      font-size: 12px;
      font-weight: 500;
      transition: all 0.2s;
    }

    .link-btn:hover {
      background: #e8e8e8;
    }

    .link-btn svg {
      width: 14px;
      height: 14px;
    }

    .footer {
      text-align: center;
      margin-top: 24px;
      color: #999;
      font-size: 12px;
    }

    .spinner {
      width: 20px;
      height: 20px;
      border: 2px solid #E3F2FD;
      border-top-color: #0064FA;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .hidden {
      display: none !important;
    }

    .progress-container {
      margin-top: 12px;
    }

    .progress-bar {
      height: 6px;
      background: #e0e0e0;
      border-radius: 3px;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #0064FA, #28B95F);
      border-radius: 3px;
      transition: width 0.3s;
    }

    .progress-text {
      font-size: 11px;
      color: #666;
      margin-top: 6px;
      text-align: center;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="logo">
        <span>L</span>
      </div>
      <div class="app-name">CRM Luelis</div>
      <div class="version">Application Desktop</div>
      <div class="version-badge" id="current-version">v0.0.0</div>
    </div>

    <!-- Update Status Card -->
    <div class="card">
      <div class="card-title">Mises à jour</div>

      <!-- Checking State -->
      <div id="state-checking" class="update-status">
        <div class="status-icon checking">
          <div class="spinner"></div>
        </div>
        <div class="status-text">
          <div class="status-title">Vérification...</div>
          <div class="status-desc">Recherche de mises à jour</div>
        </div>
      </div>

      <!-- Up to Date State -->
      <div id="state-up-to-date" class="update-status hidden">
        <div class="status-icon up-to-date">
          <svg viewBox="0 0 24 24" fill="none" stroke="#28B95F" stroke-width="2">
            <path d="M20 6L9 17l-5-5"/>
          </svg>
        </div>
        <div class="status-text">
          <div class="status-title">À jour</div>
          <div class="status-desc">Vous utilisez la dernière version</div>
        </div>
        <button class="btn btn-secondary" onclick="checkForUpdates()">
          Vérifier
        </button>
      </div>

      <!-- Update Available State -->
      <div id="state-available" class="update-status hidden">
        <div class="status-icon available">
          <svg viewBox="0 0 24 24" fill="none" stroke="#F0783C" stroke-width="2">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
            <polyline points="7 10 12 15 17 10"/>
            <line x1="12" y1="15" x2="12" y2="3"/>
          </svg>
        </div>
        <div class="status-text">
          <div class="status-title">Mise à jour disponible</div>
          <div class="status-desc" id="new-version-text">Version X.X.X disponible</div>
        </div>
      </div>

      <!-- Downloading State -->
      <div id="state-downloading" class="hidden">
        <div class="update-status">
          <div class="status-icon checking">
            <div class="spinner"></div>
          </div>
          <div class="status-text">
            <div class="status-title">Téléchargement...</div>
            <div class="status-desc" id="download-speed">Préparation...</div>
          </div>
        </div>
        <div class="progress-container">
          <div class="progress-bar">
            <div class="progress-fill" id="download-progress" style="width: 0%"></div>
          </div>
          <div class="progress-text" id="download-percent">0%</div>
        </div>
      </div>

      <!-- Ready to Install State -->
      <div id="state-ready" class="update-status hidden">
        <div class="status-icon up-to-date">
          <svg viewBox="0 0 24 24" fill="none" stroke="#28B95F" stroke-width="2">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
            <polyline points="7 10 12 15 17 10"/>
            <line x1="12" y1="15" x2="12" y2="3"/>
          </svg>
        </div>
        <div class="status-text">
          <div class="status-title">Prêt à installer</div>
          <div class="status-desc" id="ready-version-text">Version X.X.X téléchargée</div>
        </div>
        <button class="btn btn-success" onclick="installUpdate()">
          Installer
        </button>
      </div>

      <!-- Error State -->
      <div id="state-error" class="update-status hidden">
        <div class="status-icon error">
          <svg viewBox="0 0 24 24" fill="none" stroke="#F04B69" stroke-width="2">
            <circle cx="12" cy="12" r="10"/>
            <line x1="15" y1="9" x2="9" y2="15"/>
            <line x1="9" y1="9" x2="15" y2="15"/>
          </svg>
        </div>
        <div class="status-text">
          <div class="status-title">Erreur</div>
          <div class="status-desc" id="error-text">Impossible de vérifier les mises à jour</div>
        </div>
        <button class="btn btn-secondary" onclick="checkForUpdates()">
          Réessayer
        </button>
      </div>
    </div>

    <!-- Info Card -->
    <div class="card">
      <div class="card-title">Informations</div>
      <div class="info-row">
        <span class="info-label">Version</span>
        <span class="info-value" id="info-version">-</span>
      </div>
      <div class="info-row">
        <span class="info-label">Electron</span>
        <span class="info-value" id="info-electron">-</span>
      </div>
      <div class="info-row">
        <span class="info-label">Chrome</span>
        <span class="info-value" id="info-chrome">-</span>
      </div>
      <div class="info-row">
        <span class="info-label">Node.js</span>
        <span class="info-value" id="info-node">-</span>
      </div>
      <div class="info-row">
        <span class="info-label">Plateforme</span>
        <span class="info-value" id="info-platform">-</span>
      </div>
    </div>

    <!-- Links Card -->
    <div class="card">
      <div class="card-title">Liens</div>
      <div class="links">
        <a href="#" class="link-btn" onclick="openExternal('https://github.com/LUELIS/CRM-JULIEN-RONOT-V2/releases')">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
            <polyline points="7 10 12 15 17 10"/>
            <line x1="12" y1="15" x2="12" y2="3"/>
          </svg>
          Releases
        </a>
        <a href="#" class="link-btn" onclick="openExternal('https://github.com/LUELIS/CRM-JULIEN-RONOT-V2')">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"/>
          </svg>
          GitHub
        </a>
        <a href="#" class="link-btn" onclick="openExternal('https://crm.julienronot.fr')">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"/>
            <line x1="2" y1="12" x2="22" y2="12"/>
            <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/>
          </svg>
          CRM Web
        </a>
      </div>
    </div>

    <div class="footer">
      &copy; 2024 Luelis - Tous droits réservés
    </div>
  </div>

  <script>
    // Get info from main process
    if (window.electronAPI) {
      window.electronAPI.getAboutInfo().then(info => {
        document.getElementById('current-version').textContent = `v${info.version}`
        document.getElementById('info-version').textContent = info.version
        document.getElementById('info-electron').textContent = info.electron
        document.getElementById('info-chrome').textContent = info.chrome
        document.getElementById('info-node').textContent = info.node
        document.getElementById('info-platform').textContent = info.platform
      })

      // Listen for update status changes
      window.electronAPI.onUpdateStatus((status) => {
        updateUI(status)
      })

      // Request initial status
      window.electronAPI.getUpdateStatus()
    }

    function updateUI(status) {
      // Hide all states
      document.querySelectorAll('[id^="state-"]').forEach(el => el.classList.add('hidden'))

      switch (status.state) {
        case 'checking':
          document.getElementById('state-checking').classList.remove('hidden')
          break
        case 'up-to-date':
          document.getElementById('state-up-to-date').classList.remove('hidden')
          break
        case 'available':
          document.getElementById('state-available').classList.remove('hidden')
          document.getElementById('new-version-text').textContent = `Version ${status.version} disponible`
          break
        case 'downloading':
          document.getElementById('state-downloading').classList.remove('hidden')
          document.getElementById('download-progress').style.width = `${status.percent || 0}%`
          document.getElementById('download-percent').textContent = `${Math.round(status.percent || 0)}%`
          if (status.bytesPerSecond) {
            const speed = formatBytes(status.bytesPerSecond) + '/s'
            document.getElementById('download-speed').textContent = speed
          }
          break
        case 'ready':
          document.getElementById('state-ready').classList.remove('hidden')
          document.getElementById('ready-version-text').textContent = `Version ${status.version} prête`
          break
        case 'error':
          document.getElementById('state-error').classList.remove('hidden')
          document.getElementById('error-text').textContent = status.error || 'Erreur inconnue'
          break
      }
    }

    function formatBytes(bytes) {
      if (bytes < 1024) return bytes + ' B'
      if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB'
      return (bytes / (1024 * 1024)).toFixed(1) + ' MB'
    }

    function checkForUpdates() {
      if (window.electronAPI) {
        window.electronAPI.checkForUpdates()
      }
    }

    function installUpdate() {
      if (window.electronAPI) {
        window.electronAPI.installUpdate()
      }
    }

    function openExternal(url) {
      if (window.electronAPI) {
        window.electronAPI.openExternal(url)
      }
    }
  </script>
</body>
</html>
